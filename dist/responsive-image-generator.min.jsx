"use strict";var CONTEXT_MAX_WIDTHS={l:1280,m:768,s:480,xl:1920,xs:320},SRC_DIR="/images";Array.prototype.indexOf||(Array.prototype.indexOf=function(searchElement,fromIndex){var k;null==this&&alert('Error: Array.prototype.indexOf()\n"this" is null or undefined.');var o=Object(this),len=o.length>>>0;if(0==len)return-1;var n=0|fromIndex;if(len<=n)return-1;for(k=Math.max(0<=n?n:len-Math.abs(n),0);k<len;k++)if(k in o&&o[k]===searchElement)return k;return-1}),Object.keys||(Object.keys=function(){var hasOwnProperty=Object.prototype.hasOwnProperty,hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;return function(obj){"function"==typeof obj||"object"==typeof obj&&null!==obj||alert("Error: Object.keys()\nCalled on a non-object.");var prop,result=[];for(prop in obj)hasOwnProperty.call(obj,prop)&&result.push(prop);if(hasDontEnumBug)for(var i=0;i<dontEnumsLength;i++)hasOwnProperty.call(obj,dontEnums[i])&&result.push(dontEnums[i]);return result}}()),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")});var generateImgTag=function(file,resImg,argument_2){for(var tabCount=2<arguments.length&&void 0!==argument_2?argument_2:0,tabs="",i=0;i<tabCount;i++)tabs+="  ";file.writeln("".concat(tabs,"<img")),resImg.altText&&file.writeln("".concat(tabs,'  alt="').concat(resImg.altText,'"'));var contextualAssets=assets[contexts[0]];if(file.writeln("".concat(tabs,'  src="').concat(resImg.srcDir,"/").concat(getWebSafeFileName(contextualAssets[0]),'"')),1<contextualAssets.length){file.writeln("".concat(tabs,'  srcset="'));for(var _i=1,len=contextualAssets.length;_i<len;_i++)file.write("".concat(tabs,"    ").concat(resImg.srcDir,"/").concat(getWebSafeFileName(contextualAssets[_i],!0))),_i<len-1&&file.write(","),file.write("\n");file.writeln("".concat(tabs,'  "'))}file.writeln("".concat(tabs,"/>"))},generatePictureTag=function(file,resImg){file.writeln("<picture>");for(var i=contexts.length;0<i;i--){var contextualAssets=assets[contexts[i-1]],minWidth=resImg.maxWidths[contexts[i-2]]+1;if(1<i){file.writeln("  <source"),file.writeln('    media="(min-width: '.concat(minWidth/16,'em)"')),file.writeln('    srcset="');for(var _i2=0,len=contextualAssets.length;_i2<len;_i2++)file.write("      ".concat(resImg.srcDir,"/").concat(getWebSafeFileName(contextualAssets[_i2],!0))),_i2<len-1&&file.write(","),file.write("\n");file.writeln('    "'),file.writeln("  />")}else generateImgTag(file,resImg,1)}file.writeln("</picture>")},generateResponsiveImg=function(resImg){if(renameAssets){for(var i=0,len=contexts.length;i<len;i++)for(var contextualAssets=assets[contexts[i]],_i3=0,_len=contextualAssets.length;_i3<_len;_i3++)contextualAssets[_i3].name=docName;scanLayers(function(layer){for(var args=layer.name.split(","),_i4=0,_len2=args.length;_i4<_len2;_i4++){var asset=getAsset(args[_i4]),newName="";asset.size&&(newName+="".concat(asset.size," ")),newName+=docName,asset.context&&(newName+="-".concat(asset.context)),asset.def&&(newName+="-".concat(asset.def)),newName+=asset.ext,asset.qual&&(newName+=asset.qual),args[_i4]=newName}app.activeDocument.artLayers.add().remove(),layer.name=args.join(", ")})}var docPath=app.activeDocument.path,folder=Folder("".concat(docPath,"/").concat(docName,"-assets"));folder.exists||folder.create();var file=File("".concat(docPath,"/").concat(docName,"-assets/").concat(resImg.fileName,".html"));file.exists&&file.remove(),file.encoding="utf-8",file.open("w"),(hasContexts?generatePictureTag:generateImgTag)(file,resImg),file.close()},getAsset=function(str){var regExps={context:/(m(ed(ium)?)?|(e?x(tra)?-*)?(s(m(al)?l)?|l((ar)?ge)?))$/i,def:/@?[1-9](\.\d+)?x?$/i,ext:/\.(gif|jpe?g|png)$/i,qual:/(([1-9]\d?|100)%|10|[1-9])$/,size:/^\d{1,5}((\.\d{1,6})?%|([cm]m|in|px)?\s*?x\s*?\d{1,5}([cm]m|in|px)?)/i},asset={},arg=str.trim();return regExps.size.test(arg)&&(asset.size=arg.match(regExps.size)[0],arg=arg.replace(regExps.size,"").trim()),regExps.qual.test(arg)&&(asset.qual=arg.match(regExps.qual)[0],arg=arg.replace(regExps.qual,"").trim()),asset.ext=arg.match(regExps.ext)[0],arg=arg.replace(regExps.ext,"").trim(),regExps.def.test(arg)&&(asset.def=arg.match(regExps.def)[0],arg=arg.replace(regExps.def,"").replace(/[\-_]+$/,"").trim()),asset.def?asset.int=toNumber(asset.def):asset.int=1,regExps.context.test(arg)&&(asset.context=arg.match(regExps.context)[0],arg=arg.replace(regExps.context,"").replace(/[\-_]+$/,"").trim()),asset.name=arg.trim(),asset},getAssets=function(fn){scanLayers(function(layer){hasAssets=hasAssets||!0;for(var args=layer.name.split(","),i=0,len=args.length;i<len;i++){var _assets$context,asset=getAsset(args[i]),context=void 0,context=asset.context?toContext(asset.context):"xs";assets[context]?null!==(_assets$context=assets[context])&&void 0!==_assets$context&&_assets$context.push(asset):assets[context]=[asset]}}),1<(contexts=sortContexts(Object.keys(assets))).length&&(hasContexts=!0);for(var i=0,len=contexts.length;i<len;i++)assets[contexts[i]]=sortAssets(assets[contexts[i]]);fn()},getWebSafeFileName=function(asset,argument_1){var isSrcSetRef=1<arguments.length&&void 0!==argument_1&&argument_1,fileName="";return fileName+=asset.name.replace(/\s/g,"%20"),asset.context&&(fileName+="-".concat(asset.context)),asset.def&&(fileName+="-".concat(asset.def)),fileName+=asset.ext,isSrcSetRef&&(fileName+=" ".concat(asset.int,"x")),fileName},hasExtension=function(str,argument_1){var types=1<arguments.length&&void 0!==argument_1?argument_1:["gif","jpe?g","png"];if(0===types.length)return!1;for(var regExp="\\.(",i=0,len=types.length;i<len;i++)i!==types.length-1?regExp+="".concat(types[i],"|"):regExp+="".concat(types[i],")");return new RegExp(regExp,"i").test(str)},isGroup=function(layer){return"LayerSet"===layer.typename},scanLayers=function scanLayers(fn,argument_1){for(var layers=1<arguments.length&&void 0!==argument_1?argument_1:app.activeDocument.layers,i=0,len=layers.length;i<len;i++)hasExtension(layers[i].name)&&fn(layers[i]),isGroup(layers[i])&&scanLayers(fn,layers[i].layers)},showDialog=function(fn){var dialog=new Window("dialog","Generate Responsive Image");dialog.margins=16;var infoPanel=dialog.add("panel",void 0,"Image Information");infoPanel.alignment="fill",infoPanel.margins=16,infoPanel.spacing=12;var fileNameGroup=infoPanel.add("group");fileNameGroup.add("statictext",void 0,"File Name"),fileNameGroup.alignment="right",fileNameGroup.spacing=0;var fileNameInput=fileNameGroup.add("edittext",void 0,docName);fileNameInput.characters=16,fileNameInput.helpTip="Add the image's file name";var srcDirGroup=infoPanel.add("group");srcDirGroup.add("statictext",void 0,"Src Directory"),srcDirGroup.alignment="right",srcDirGroup.spacing=0;var srcDirInput=srcDirGroup.add("edittext",void 0,SRC_DIR);srcDirInput.characters=16,srcDirInput.helpTip="Add the image's src directory path";var altTextGroup=infoPanel.add("group");altTextGroup.add("statictext",void 0,"Alt Text"),altTextGroup.alignment="right",altTextGroup.spacing=0;var altTextInput=altTextGroup.add("edittext");altTextInput.active=!0,altTextInput.characters=16,altTextInput.helpTip="Add the image's alt text";var contextInputs={};if(hasContexts){var contextPanel=dialog.add("panel",void 0,"Image Breakpoints");contextPanel.alignment="fill",contextPanel.margins=16,contextPanel.spacing=12;for(var i=0,len=contexts.length-1;i<len;i++){var contextGroup=contextPanel.add("group");contextGroup.add("statictext",void 0,"".concat(contexts[i].toUpperCase(),":")),contextGroup.alignment="right",contextGroup.spacing=0;var contextInput=contextGroup.add("edittext",void 0,"".concat(CONTEXT_MAX_WIDTHS[contexts[i]],"px"));contextInput.characters=16,contextInput.helpTip="Add the context's max-width",contextInputs[contexts[i]]=contextInput}}var renameCheckbox=dialog.add("checkbox",void 0,"Rename Image Assets");renameCheckbox.alignment="fill",renameCheckbox.helpTip="Rename image assets as Photoshop document's name",renameCheckbox.value=renameAssets;var btnGroup=dialog.add("group");btnGroup.alignment="right",btnGroup.spacing=0,btnGroup.add("button",void 0,"Cancel").onClick=function(){dialog.close()},btnGroup.add("button",void 0,"Save").onClick=function(){dialog.close(),renameAssets=renameCheckbox.value;var resImg={altText:"",fileName:docName,maxWidths:{},srcDir:SRC_DIR};if(altTextInput.text&&(resImg.altText=altTextInput.text.trim()),fileNameInput.text&&(resImg.fileName=fileNameInput.text.trim()),hasContexts)for(var i=0,len=contexts.length-1;i<len;i++)contextInputs[contexts[i]].text?resImg.maxWidths[contexts[i]]=toNumber(contextInputs[contexts[i]].text):resImg.maxWidths[contexts[i]]=CONTEXT_MAX_WIDTHS[contexts[i]];srcDirInput.text&&(resImg.srcDir=srcDirInput.text.trim().replace(/\s+/g,"%20").replace(/\/+$/,"")),fn(resImg)},dialog.show()},sortAssets=function(arr){for(var sortedArr=arr.sort(function(a,b){return a.int<b.int?-1:1}),uniqueInts=[],uniqueSortedArr=[],i=0,len=sortedArr.length;i<len;i++)-1===uniqueInts.indexOf(sortedArr[i].int)?(uniqueInts.push(sortedArr[i].int),uniqueSortedArr.push(sortedArr[i])):uniqueSortedArr[uniqueInts.indexOf(sortedArr[i].int)]=sortedArr[i];return uniqueSortedArr},sortContexts=function(arr){var orderedContexts={xs:0,s:1,m:2,l:3,xl:4};return arr.sort(function(a,b){return orderedContexts[a]-orderedContexts[b]})},toContext=function(str){switch(!0){case/^l((ar)?ge)?$/i.test(str):return"l";case/^m(ed(ium)?)?$/i.test(str):return"m";case/^s(m(al)?l)?$/i.test(str):return"s";case/^e?x(tra)?-*l((ar)?ge)?$/i.test(str):return"xl";default:return"xs"}},toNumber=function(str){return/\d/.test(str)?parseFloat(str.match(/\d+(\.\d+)?/)[0]):NaN},assets={},contexts=[],docName=app.activeDocument.name.replace(/\.[a-z]{3,4}$/i,""),hasAssets=!1,hasContexts=!1,renameAssets=!1;getAssets(function(){hasAssets&&showDialog(function(resImg){generateResponsiveImg(resImg)})});