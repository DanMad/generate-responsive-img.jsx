"use strict";var CONTEXT_MAX_WIDTHS={l:1280,m:768,s:480,xl:1920,xs:320},FILE_NAME="responsive-image",SRC_DIR="/images";Array.prototype.indexOf||(Array.prototype.indexOf=function(searchElement,fromIndex){var k;null==this&&alert('Error: Array.prototype.indexOf()\n"this" is null or undefined.');var o=Object(this),len=o.length>>>0;if(0==len)return-1;var n=0|fromIndex;if(len<=n)return-1;for(k=Math.max(0<=n?n:len-Math.abs(n),0);k<len;k++)if(k in o&&o[k]===searchElement)return k;return-1}),Object.keys||(Object.keys=function(){var hasOwnProperty=Object.prototype.hasOwnProperty,hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;return function(obj){"function"==typeof obj||"object"==typeof obj&&null!==obj||alert("Error: Object.keys()\nCalled on a non-object.");var prop,result=[];for(prop in obj)hasOwnProperty.call(obj,prop)&&result.push(prop);if(hasDontEnumBug)for(var i=0;i<dontEnumsLength;i++)hasOwnProperty.call(obj,dontEnums[i])&&result.push(dontEnums[i]);return result}}()),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")});var generateImgTag=function(file,assets,resImg,argument_3){for(var tabCount=3<arguments.length&&void 0!==argument_3?argument_3:0,tabs="",i=0;i<tabCount;i++)tabs+="  ";if(file.writeln("".concat(tabs,"<img")),resImg.altText&&file.writeln("".concat(tabs,'  alt="').concat(resImg.altText,'"')),file.writeln("".concat(tabs,'  src="').concat(resImg.srcDir,"/").concat(assets[0].fileName,'"')),1<assets.length){file.writeln("".concat(tabs,'  srcset="'));for(var _i=1,len=assets.length;_i<len;_i++)file.write("".concat(tabs,"    ").concat(resImg.srcDir,"/").concat(assets[_i].fileName," ").concat(assets[_i].def,"x")),_i<len-1&&file.write(","),file.write("\n");file.writeln("".concat(tabs,'  "'))}file.writeln("".concat(tabs,"/>"))},generatePictureTag=function(file,resImg){file.writeln("<picture>");for(var contexts=sortContexts(Object.keys(assets)),maxWidths=sortContexts(Object.keys(resImg.maxWidths)),i=contexts.length;0<i;i--){var contextualAssets=sortAssets(assets[contexts[i-1]]),minWidth=resImg.maxWidths[maxWidths[i-2]]+1;if(1<i){file.writeln("  <source"),file.writeln('    media="(min-width: '.concat(minWidth/16,'em)"')),file.writeln('    srcset="');for(var _i2=0,len=contextualAssets.length;_i2<len;_i2++)file.write("      ".concat(resImg.srcDir,"/").concat(contextualAssets[_i2].fileName," ").concat(contextualAssets[_i2].def,"x")),_i2<len-1&&file.write(","),file.write("\n");file.writeln('    "'),file.writeln("  />")}else generateImgTag(file,contextualAssets,resImg,1)}file.writeln("</picture>")},generateResponsiveImg=function(resImg){var context,contextualAssets,docName=app.activeDocument.name.replace(/\.[a-z]{3,4}$/i,""),docPath=app.activeDocument.path,file=File("".concat(docPath,"/").concat(docName,"-assets/").concat(resImg.fileName,".html"));file.exists&&file.remove(),file.encoding="utf-8",file.open("w"),hasContexts?generatePictureTag(file,resImg):(context=Object.keys(assets)[0],contextualAssets=sortAssets(assets[context]),generateImgTag(file,contextualAssets,resImg)),file.close()},getAsset=function(str){var regExps={context:/(m(ed(ium)?)?|(e?x(tra)?-*)?(s(m(al)?l)?|l((ar)?ge)?))$/i,def:/\-@?[1-9](\.\d+)?x?$/i,ext:/\.(gif|jpe?g|png)$/i,qual:/(([1-9]\d?|100)%|10|[1-9])$/,size:/^\d{1,5}((\.\d{1,3})?%|([cm]m|in|px)?\s*?x\s*?\d{1,5}([cm]m|in|px)?)\s*/i},fileName=str.trim();regExps.size.test(fileName)&&(fileName=fileName.replace(regExps.size,"")),regExps.qual.test(fileName)&&(fileName=fileName.replace(regExps.qual,""));var asset={fileName:fileName.replace(/\s+/g,"%20")};regExps.ext.test(fileName)&&(fileName=fileName.replace(regExps.ext,"")),regExps.def.test(fileName)?(asset.def=toNumber(fileName.match(regExps.def)[0]),fileName=fileName.replace(regExps.def,"")):asset.def=1;var _assets$context,context="xs";regExps.context.test(fileName)&&(context=toContext(fileName.match(regExps.context)[0])),assets[context]?null!==(_assets$context=assets[context])&&void 0!==_assets$context&&_assets$context.push(asset):assets[context]=[asset]},getAssets=function getAssets(fn,argument_1,argument_2){var layers=1<arguments.length&&void 0!==argument_1?argument_1:app.activeDocument.layers,depth=2<arguments.length&&void 0!==argument_2?argument_2:0;depth++;for(var i=0,len=layers.length;i<len;i++){if(hasExtension(layers[i].name))for(var args=layers[i].name.split(","),_i3=0,_len=args.length;_i3<_len;_i3++)hasExtension(args[_i3])&&(getAsset(args[_i3]),hasAssets=hasAssets||!0);isGroup(layers[i])&&getAssets(fn,layers[i].layers,depth)}--depth||fn()},hasExtension=function(str,argument_1){var types=1<arguments.length&&void 0!==argument_1?argument_1:["gif","jpe?g","png"];if(0===types.length)return!1;for(var regExp="\\.(",i=0,len=types.length;i<len;i++)i!==types.length-1?regExp+="".concat(types[i],"|"):regExp+="".concat(types[i],")");return new RegExp(regExp,"i").test(str)},isGroup=function(layer){return"LayerSet"===layer.typename},showDialog=function(fn){var dialog=new Window("dialog","Generate Responsive Image");dialog.margins=16;var infoPanel=dialog.add("panel",void 0,"Image Information");infoPanel.alignment="fill",infoPanel.margins=16,infoPanel.spacing=12;var fileNameGroup=infoPanel.add("group");fileNameGroup.add("statictext",void 0,"File Name"),fileNameGroup.alignment="right",fileNameGroup.spacing=0;var fileNameInput=fileNameGroup.add("edittext",void 0,FILE_NAME);fileNameInput.characters=16,fileNameInput.helpTip="Add the image's file name";var srcDirGroup=infoPanel.add("group");srcDirGroup.add("statictext",void 0,"Src Directory"),srcDirGroup.alignment="right",srcDirGroup.spacing=0;var srcDirInput=srcDirGroup.add("edittext",void 0,SRC_DIR);srcDirInput.characters=16,srcDirInput.helpTip="Add the image's src directory path";var altTextGroup=infoPanel.add("group");altTextGroup.add("statictext",void 0,"Alt Text"),altTextGroup.alignment="right",altTextGroup.spacing=0;var altTextInput=altTextGroup.add("edittext");altTextInput.active=!0,altTextInput.characters=16,altTextInput.helpTip="Add the image's alt text";var contextInputs={},contexts=sortContexts(Object.keys(assets));if(1<contexts.length){var contextPanel=dialog.add("panel",void 0,"Image Breakpoints");contextPanel.alignment="fill",contextPanel.margins=16,contextPanel.spacing=12;for(var i=0,len=contexts.length-1;i<len;i++){var contextGroup=contextPanel.add("group");contextGroup.add("statictext",void 0,"".concat(contexts[i].toUpperCase(),":")),contextGroup.alignment="right",contextGroup.spacing=0;var contextInput=contextGroup.add("edittext",void 0,"".concat(CONTEXT_MAX_WIDTHS[contexts[i]],"px"));contextInput.characters=16,contextInput.helpTip="Add the context's max-width",contextInputs[contexts[i]]=contextInput}hasContexts=!0}var btnGroup=dialog.add("group");btnGroup.alignment="right",btnGroup.spacing=0,btnGroup.add("button",void 0,"Cancel").onClick=function(){dialog.close()},btnGroup.add("button",void 0,"Save").onClick=function(){dialog.close();var resImg={altText:"",fileName:FILE_NAME,maxWidths:{},srcDir:SRC_DIR};if(altTextInput.text&&(resImg.altText=altTextInput.text),fileNameInput.text&&(resImg.fileName=fileNameInput.text.trim()),hasContexts)for(var i=0,len=contexts.length-1;i<len;i++)contextInputs[contexts[i]].text?resImg.maxWidths[contexts[i]]=toNumber(contextInputs[contexts[i]].text):resImg.maxWidths[contexts[i]]=CONTEXT_MAX_WIDTHS[contexts[i]];srcDirInput.text&&(resImg.srcDir=srcDirInput.text.trim().replace(/\s+/g,"%20").replace(/\/+$/,"")),fn(resImg)},dialog.show()},sortAssets=function(arr){for(var sortedArr=arr.sort(function(a,b){return a.def<b.def?-1:1}),uniqueDefs=[],uniqueSortedArr=[],i=0,len=sortedArr.length;i<len;i++)-1===uniqueDefs.indexOf(sortedArr[i].def)&&(uniqueDefs.push(sortedArr[i].def),uniqueSortedArr.push(sortedArr[i]));return uniqueSortedArr},sortContexts=function(arr){for(var sortedContexts=["xs","s","m","l","xl"],sortedArr=[],i=0,len=sortedContexts.length;i<len;i++)-1!==arr.indexOf(sortedContexts[i])&&sortedArr.push(sortedContexts[i]);return sortedArr},toContext=function(str){switch(!0){case/^l((ar)?ge)?$/i.test(str):return"l";case/^m(ed(ium)?)?$/i.test(str):return"m";case/^s(m(al)?l)?$/i.test(str):return"s";case/^e?x(tra)?-*l((ar)?ge)?$/i.test(str):return"xl";default:return"xs"}},toNumber=function(str){return/\d/.test(str)?parseFloat(str.match(/\d+(\.\d+)?/)[0]):NaN},assets={},hasAssets=!1,hasContexts=!1;getAssets(function(){hasAssets&&showDialog(function(resImg){generateResponsiveImg(resImg)})});